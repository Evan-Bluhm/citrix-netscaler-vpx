---
copyright:
  years: 1994, 2018

lastupdated: "2018-11-12"
---

{:shortdesc: .shortdesc}
{:new_window: target="_blank"}

# Citrix Netscaler VPX を高可用性 (HA) 用にセットアップ
{: #setting-up-citrix-netscaler-vpx-for-high-availability-ha-}

ロード・バランサーは、複数のアプリケーション・サーバーにわたってトラフィックのバランスを取り、スケーラブルなアプリケーションのパフォーマンスと安定性を向上させるために使用されます。 ただし、単一のロード・バランサーは Single Point of Failure になります。 これを回避するには、高可用性 (HA) Netscaler VPX ペアを構成します。 HA ペアを構成するには、2 台の Netscaler VPX サーバーが必要です。 1 次サーバーで障害が発生した場合、2 次サーバーがステップインしてロード・バランシングを続行します。 

SNIP (SubNet IP) は、ロード・バランシングされたサーバーにより、Netscaler VPX の VIP (仮想 IP) に対して行われた要求 (接続) のソース IP と見なされる IP です。 通常、HA ペアのセットアップでは SNIP は変更されませんが、フェイルオーバー・イベント時には変更される可能性があります。 2 つの Netscaler が同じサブネット内にある場合、2 次 Netscaler VPX の SNIP が、1 次 Netscaler VPX によって元々使用されていた SNIP に変更される可能性があります。 これによって、要求を処理するサーバーで混乱が生じることはありません。

HA 構成の場合、両方の NetScaler は、同じ VLAN 内で、同じサブネット上にある必要があります。

HA 構成を開始する前に、以下の前提条件アクションを必ず実行してください。

1. ペアがアクティブ/アクティブとして構成される場合、インスタンスに追加される VIP サブネットのタイプは「VLAN にルーティング (Routed to VLAN)」でなければなりません。
2. ペアがアクティブ/パッシブとして構成される場合、インスタンスに追加される VIP サブネットは、「VLAN にルーティング (Routed to VLAN)」または「2 次を IP にルーティング (Secondary routed to IP)」のいずれかであり、1 次ノードのパブリック IP アドレスにルーティングされる必要があります。

必要な VLAN 内の 2 台の Netscaler VPX サーバーを注文し、HA ペア構成の前提条件を満たすために VIP サブネットと SNIP サブネットを注文した後、以下を実行できます。

1. 2 つのブラウザー・ウィンドウを開き、両方の NetScaler の拡張インターフェースにログインします。 2 次 NetScaler で、**「システム」 > 「ユーザー管理」 > 「ユーザー」**に移動し、ルート・パスワードを 1 次 NetScaler と同じに設定します。 次に、デバイスの詳細ページで {{site.data.keyword.BluSoftlayer_notm}} ポータル内のファイルのパスワードを更新して、2 次 NetScaler 用に設定したパスワードと一致させます。

2. 2 次として使用する VPX で、**「システム」>「高可用性 (High Availability)」**をクリックし、次に最初の行を右クリックし、**「編集」**をクリックします。 「高可用性状況構成 (High Availability Status config)」ドロップダウン・ボックスで**「2 次に留まる (Stay Secondary)」**を選択し、**「OK」**をクリックします。

3. **「追加 (Add)」**を選択します。 もう一方の VPX のシステム IP アドレス (1 次の「高可用性 (High Availability)」タブにある) を入力し、下部に root ログインの詳細を入力します。 **「INC をオンにする (Turn on INC)」** ボックスのチェック・マークを外したままにします。 **「OK」**をクリックします。 
	
	IP が同じサブネット内にないことを示すエラーを受け取った場合、両方の VPX サーバーが同じ VLAN 内にない可能性があります。 そうでない場合は、1 次サーバーを開き、**「最新表示 (Refresh)」**ボタンを選択して、両方のサーバーが高可用性で動作していることを確認できるはずです。 

	2 次の新規 NetScaler 管理 IP は、前の IP アドレスより 1 つ低くなります。 2 次 VPX にアクセスできない場合は、以下を使用して、コマンド・ラインから高可用性を削除します。

	`sh ha node`

	次に、以下のようにして、HA ノードとなるノードを削除します。
	
	`rm ha node 1`

4. 1 次 VPX で、リモート VPX が現在同期中であることがわかるはずです。 2 次サーバーに移動し、**「ネットワーク (Network)」>「IP」**構成を確認します。 1 次サーバーの VIP とその他の IP がパッシブとしてリストされているのを確認できるはずです。

6. 2 次サーバーで**「システム」>「高可用性 (High Availability)」**に戻り、**「編集」**をクリックします。 ドロップダウン・ボックスで**「有効 (ENABLED)」** を選択し、**「OK」**を押します。

7. 強制的にフェイルオーバーしてテストを行います。 画面を最新表示し、2 次サーバーで IP アドレスがアクティブになることを確認します。 再びフェイルオーバーし、それらがパッシブになることを確認します。 IP を ping し、それらが機能していることを確認します。

8. これで、1 次サーバーに 1 次のラベルが付けられ、2 次サーバーは、成功の同期状態を報告するはずです。
